#!/bin/sh
APP="$0"
while [ -h "$APP" ] ; do
  ls=$(ls -ld "$APP")
  link=$(expr "$ls" : '.*-> \(.*\)$')
  if expr "$link" : '/.*' > /dev/null; then
    APP="$link"
  else
    APP=$(dirname "$APP")"/$link"
  fi
done
NAME=$(basename "$APP")
APP=$(dirname "$APP")
APP=$(cd "$APP" && pwd)
APP="$APP/$NAME"
PATH=$PATH
JAVA=java
OPTIONS=-Djava.awt.headless=true
MAIN=net.oneandone.stool.Main

SHELL_FILE=/tmp/.shell-file-$$-$(date +%N)

$JAVA $OPTIONS $STOOL_OPTS -cp "$APP" $MAIN -shell $SHELL_FILE "$@"
result=$?

if [ -f $SHELL_FILE ] ; then
  . $SHELL_FILE
  rm $SHELL_FILE
fi

exit $result
